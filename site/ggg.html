<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ï–ì–≠ –ø–æ –æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏—é</title>

    <!-- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –§–ê–ô–õ–ê –° –¢–ï–û–†–ò–ï–ô -->
    <script src="theory.js"></script>

    <style>
        :root {
            --theory-color: #3498db;
            --practice-color: #2ecc71;
            --bg-color: #f4f7f9;
            --text-color: #2c3e50;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background: var(--bg-color); color: var(--text-color); padding: 20px; }

        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); }

        header { text-align: center; margin-bottom: 30px; }
        .progress-wrapper { background: #eee; height: 10px; border-radius: 5px; margin: 20px 0; overflow: hidden; }
        .progress-bar { background: linear-gradient(90deg, var(--theory-color), var(--practice-color)); height: 100%; width: 0%; transition: 0.8s; }

        .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 15px; background: #fff; border: 1px solid #eee; border-radius: 12px; }
        .month-nav { display: flex; align-items: center; gap: 20px; }
        .btn { background: var(--text-color); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; }

        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px; }
        .day-label { text-align: center; font-weight: bold; color: #95a5a6; font-size: 0.8rem; text-transform: uppercase; }

        .day-card {
            background: white; border: 2px solid #f0f0f0; border-radius: 12px; min-height: 100px; padding: 12px;
            cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; justify-content: space-between;
        }
        .day-card:hover { border-color: var(--theory-color); transform: translateY(-2px); }
        .day-card.completed { background: #f8fff9; border-color: var(--practice-color); }

        .day-theory { border-left: 4px solid var(--theory-color); }
        .day-practice { border-left: 4px solid var(--practice-color); }

        .date-num { font-size: 0.7rem; color: #bdc3c7; }
        .day-type { font-size: 0.65rem; font-weight: bold; text-transform: uppercase; }
        .topic-hint { font-size: 0.75rem; line-height: 1.2; color: #444; margin-top: 5px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; backdrop-filter: blur(4px); justify-content: center; align-items: center; }
        .modal-content { background: white; width: 95%; max-width: 700px; border-radius: 20px; overflow: hidden; max-height: 90vh; display: flex; flex-direction: column; }
        .modal-header { padding: 20px; color: white; display: flex; justify-content: space-between; align-items: center; }
        .header-theory { background: var(--theory-color); }
        .header-practice { background: var(--practice-color); }
        .modal-body { padding: 30px; overflow-y: auto; line-height: 1.6; }
        .modal-footer { padding: 15px; border-top: 1px solid #eee; text-align: center; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–æ—Ä–∏–∏ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ */
        .image-placeholder { background: #f8f9fa; border: 2px dashed #cbd5e0; border-radius: 10px; padding: 30px 10px; text-align: center; color: #718096; margin: 15px 0; font-size: 0.8rem; }
        .theory-section h3 { color: #2c3e50; border-left: 4px solid var(--theory-color); padding-left: 10px; margin: 20px 0 10px; }
        .test-item { background: #fffef0; padding: 15px; border-radius: 8px; border: 1px solid #ffeeba; margin-top: 15px; }
        details { cursor: pointer; color: var(--practice-color); font-weight: bold; margin-top: 10px; }

        @media (max-width: 900px) {
            .calendar { grid-template-columns: repeat(2, 1fr); }
            .day-label { display: none; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üìö –ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –ï–ì–≠</h1>
        <div class="progress-wrapper"><div class="progress-bar" id="progressBar"></div></div>
    </header>

    <div class="controls">
        <div class="month-nav">
            <button class="btn" onclick="changeMonth(-1)">‚Üê</button>
            <h2 id="monthTitle">–°–µ–Ω—Ç—è–±—Ä—å</h2>
            <button class="btn" onclick="changeMonth(1)">‚Üí</button>
        </div>
        <div id="statsText" style="font-weight: bold; color: #7f8c8d;">–í—ã–ø–æ–ª–Ω–µ–Ω–æ: 0%</div>
    </div>

    <div class="calendar" id="calendarGrid"></div>
</div>

<div class="modal" id="dayModal">
    <div class="modal-content">
        <div class="modal-header" id="modalHeader">
            <h3 id="modalTitle">–ó–∞–¥–∞–Ω–∏–µ</h3>
            <button style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
        <div class="modal-footer">
            <button class="btn" id="doneBtn" style="background: var(--practice-color); width: 100%; padding: 15px;">‚úÖ –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
        </div>
    </div>
</div>

<script>
    const months = [
        { name: "–°–µ–Ω—Ç—è–±—Ä—å", weeks: 4 }, { name: "–û–∫—Ç—è–±—Ä—å", weeks: 4 },
        { name: "–ù–æ—è–±—Ä—å", weeks: 5 }, { name: "–î–µ–∫–∞–±—Ä—å", weeks: 4 },
        { name: "–Ø–Ω–≤–∞—Ä—å", weeks: 4 }, { name: "–§–µ–≤—Ä–∞–ª—å", weeks: 4 },
        { name: "–ú–∞—Ä—Ç", weeks: 5 }, { name: "–ê–ø—Ä–µ–ª—å", weeks: 4 },
        { name: "–ú–∞–π", weeks: 4 }
    ];

    let currentMonthIdx = 0;
    let completedDays = JSON.parse(localStorage.getItem('ege_final_done') || '[]');

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = '';
        document.getElementById('monthTitle').textContent = months[currentMonthIdx].name;

        ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'].forEach(d => {
            const el = document.createElement('div');
            el.className = 'day-label';
            el.textContent = d;
            grid.appendChild(el);
        });

        let startWeek = 1;
        for(let i=0; i<currentMonthIdx; i++) startWeek += months[i].weeks;

        for(let w=0; w < months[currentMonthIdx].weeks; w++) {
            const weekNum = startWeek + w;
            const topicA = allTopics[(weekNum - 1) * 2];
            const topicB = allTopics[(weekNum - 1) * 2 + 1] || topicA;

            for(let d=0; d<7; d++) {
                const dayId = `${weekNum}-${d}`;
                const isDone = completedDays.includes(dayId);
                const isTheory = (d === 0 || d === 2);
                const currentTopic = (d < 2) ? topicA : topicB;

                const card = document.createElement('div');
                card.className = `day-card ${isTheory ? 'day-theory' : 'day-practice'} ${isDone ? 'completed' : ''}`;
                card.innerHTML = `
                    <div class="date-num">–ù–ï–î–ï–õ–Ø ${weekNum}</div>
                    <div class="day-type" style="color:${isTheory?'var(--theory-color)':'var(--practice-color)'}">${isTheory?'–¢–µ–æ—Ä–∏—è':'–ü—Ä–∞–∫—Ç–∏–∫–∞'}</div>
                    <div class="topic-hint"><b>${currentTopic.id}</b> ${currentTopic.title}</div>
                `;
                card.onclick = () => openDay(weekNum, d, topicA, topicB, dayId);
                grid.appendChild(card);
            }
        }
        updateStats();
    }

    function openDay(weekNum, dIdx, tA, tB, dayId) {
        const modal = document.getElementById('dayModal');
        const mBody = document.getElementById('modalBody');
        const mHeader = document.getElementById('modalHeader');

        const isTheory = (dIdx === 0 || dIdx === 2);
        const isBasicPractice = (dIdx === 1 || dIdx === 3);
        const currentTopic = (dIdx < 2) ? tA : tB;

        let content = "";

        if (isTheory) {
            content = currentTopic.theoryContent;
        } else if (isBasicPractice) {
            content = currentTopic.practiceContent;
        } else {
            content = generateWeekendTask(dIdx, tA, tB);
        }

        mBody.innerHTML = `<div style="font-size:0.8rem; color:#7f8c8d; margin-bottom:10px;">${currentTopic.section}</div>${content}`;
        mHeader.className = `modal-header ${isTheory ? 'header-theory' : 'header-practice'}`;
        modal.style.display = 'flex';

        document.getElementById('doneBtn').onclick = () => {
            if(!completedDays.includes(dayId)) completedDays.push(dayId);
            localStorage.setItem('ege_final_done', JSON.stringify(completedDays));
            closeModal();
            renderCalendar();
        };
    }

    function generateWeekendTask(dIdx, tA, tB) {
        if(dIdx === 4) return `<h3>–ü—è—Ç–Ω–∏—Ü–∞: –¢–µ–∫—Å—Ç—ã (17-20)</h3><p>–ù–∞–π–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ —Ç–µ–º–µ <b>${tA.id}</b> –∏–ª–∏ <b>${tB.id}</b> –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫ –Ω–µ–º—É –∑–∞–¥–∞–Ω–∏—è.</p>`;
        if(dIdx === 5) return `<h3>–°—É–±–±–æ—Ç–∞: –°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h3><p>–°–æ—Å—Ç–∞–≤—å—Ç–µ –ø–ª–∞–Ω—ã (24) –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è (25) –ø–æ —Ç–µ–º–∞–º –Ω–µ–¥–µ–ª–∏.</p>`;
        return `<h3>–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: –ü—Ä–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç</h3><p>–†–µ—à–∏—Ç–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –ï–ì–≠ –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤.</p>`;
    }

    function closeModal() { document.getElementById('dayModal').style.display = 'none'; }
    function changeMonth(dir) { currentMonthIdx = Math.max(0, Math.min(8, currentMonthIdx + dir)); renderCalendar(); }
    function updateStats() {
        const percent = Math.round((completedDays.length / (38 * 7)) * 100);
        document.getElementById('progressBar').style.width = percent + '%';
        document.getElementById('statsText').textContent = `–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${percent}%`;
    }
    window.onclick = (e) => { if(e.target == document.getElementById('dayModal')) closeModal(); }
    renderCalendar();
</script>

</body>
</html>